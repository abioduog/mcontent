<h1 th:inline="text">[[${deliveryPipe.name}]] content</h1>
<div class="content-menu">
    <div class="calendar-menu"></div>
    <script th:inline="javascript">
        var deliveryPipeContentListUrl = /*[[@{|/deliverypipe/${deliveryPipe.id}/content/list|}]]*/;
        var contentUrlBase = /*[[@{|/deliverypipe/${deliveryPipe.id}/scheduled/|}]]*/;

        function createContent(event) {
            event.preventDefault();
            mContent.loaders.contentEditor(contentUrlBase + "create?date=" + $.lastClickedScheduledDay.date._i);
            return false;
        };

        function editContent(event) {
            event.preventDefault();
            mContent.loaders.contentEditor(contentUrlBase + $.lastClickedScheduledDay.events[0].id);
            return false;
        };

        function approve(event) {
            event.preventDefault();
            mContent.ajax.get(contentUrlBase + $.lastClickedScheduledDay.events[0].id + "/approve", function (data) {
                mContent.notify("Content approved.", "info");
                mContent.loaders.workArea(deliveryPipeContentListUrl);
            }, function (error) {
                console.log(error);
                mContent.notify("Failed to approve content.", "warning");
                mContent.loaders.workArea(deliveryPipeContentListUrl);
            });
            return false;
        }

        function disapprove(event) {
            event.preventDefault();
            mContent.ajax.get(contentUrlBase + $.lastClickedScheduledDay.events[0].id + "/disapprove", function (data) {
                mContent.notify("Content disapproved.", "info");
                mContent.loaders.workArea(deliveryPipeContentListUrl);
            }, function (error) {
                console.log(error);
                mContent.notify("Failed to disapprove content.", "warning");
                mContent.loaders.workArea(deliveryPipeContentListUrl);
            });
            return false;
        }

        $(".calendar-menu").clndr({
            weekOffset: 1,
            events: /*[[${contents}]]*/ [],
            clickEvents: {
                click: function(target) {
                    window.debug = target;
                    $.lastClickedScheduledDay = target;
                    if(target.events.length > 0) {
                        $(".context-menu-content-title").text(target.events[0].title);
                    }
                }
            }
        });
        $(".calendar-menu").find(".day:not(.past):not(.event)").attr("data-jq-dropdown", "#create-content-context-menu");
        $(".calendar-menu").find(".day:not(.past).event").attr("data-jq-dropdown", "#edit-content-context-menu");
        $(".calendar-menu").find(".day.past.event").attr("data-jq-dropdown", "#view-content-context-menu");
/*        $('#jq-dropdown-1').on('show', function(event, dropdownData) {
            console.log(dropdownData.trigger.context);
        }).on('hide', function(event, dropdownData) {
            $.lastClickedScheduledDay = null;
        });*/
    </script>
    <div id="create-content-context-menu" class="jq-dropdown jq-dropdown-tip">
        <ul class="jq-dropdown-menu">
            <li><a onclick="createContent(event);">Create</a></li>
        </ul>
    </div>
    <div id="edit-content-context-menu" class="jq-dropdown jq-dropdown-tip">
        <ul class="jq-dropdown-menu">
            <li class="context-menu-content-title"></li>
            <li class="jq-dropdown-divider"></li>
            <li><a onclick="editContent(event);">Edit</a></li>
            <li class="jq-dropdown-divider" sec:authorize="hasRole('ADMIN')"></li>
            <li sec:authorize="hasRole('ADMIN')">
                <a th:text="#{deliverable.status.approve}" onclick="approve(event);">Approve</a>
            </li>
            <li sec:authorize="hasRole('ADMIN')">
                <a th:text="#{deliverable.status.disapprove}" onclick="disapprove(event);">Disapprove</a>
            </li>
        </ul>
    </div>
    <div id="view-content-context-menu" class="jq-dropdown jq-dropdown-tip">
        <ul class="jq-dropdown-menu">
            <li class="context-menu-content-title"></li>
            <li class="jq-dropdown-divider"></li>
            <li><a onclick="editContent();">View</a></li>
        </ul>
    </div>
</div>
<div id="content-editor"></div>